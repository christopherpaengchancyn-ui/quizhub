<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>QuizHub Lobby</title>
<style>
*{box-sizing:border-box;}
body{font-family:'Segoe UI',Arial,sans-serif;background:#0f1112;color:#cfc5b8;display:flex;justify-content:center;align-items:flex-start;padding:20px 15px;margin:0;min-height:100vh;}
.card{background:#24201c;padding:30px;border-radius:16px;width:100%;max-width:700px;box-shadow:0 8px 40px rgba(0,0,0,0.5);}
.back-link{color:rgba(255,255,255,0.5);text-decoration:none;font-size:13px;display:inline-flex;align-items:center;gap:6px;margin-bottom:20px;transition:color 0.2s;}
.back-link:hover{color:#d9b78a;}
.page-header{text-align:center;margin-bottom:20px;}
h1{color:#d9b78a;margin:0;font-size:24px;font-weight:600;}
.room-code-display{background:rgba(255,255,255,0.02);padding:28px;border-radius:14px;text-align:center;margin-bottom:25px;border:1px solid rgba(255,255,255,0.05);}
.room-code-label{color:rgba(255,255,255,0.45);font-size:11px;margin-bottom:10px;text-transform:uppercase;letter-spacing:1.5px;}
.room-code{font-size:42px;font-weight:700;color:#d9b78a;letter-spacing:10px;font-family:monospace;}
.copy-btn{background:rgba(255,255,255,0.08);border:none;padding:10px 18px;border-radius:8px;cursor:pointer;color:#cfc5b8;margin-top:15px;transition:all 0.2s;font-size:13px;}
.copy-btn:hover{background:rgba(255,255,255,0.12);}
.players-section{background:rgba(255,255,255,0.02);padding:18px;border-radius:12px;margin:15px 0;border:1px solid rgba(255,255,255,0.05);}
.players-grid{display:flex;flex-wrap:wrap;gap:10px;margin-top:12px;}
.player-chip{display:flex;align-items:center;gap:8px;background:rgba(255,255,255,0.05);padding:8px 14px;border-radius:25px;}
.player-chip .avatar{font-size:18px;}
.player-chip .name{font-size:13px;font-weight:500;}
.empty-msg{color:rgba(255,255,255,0.35);font-size:13px;text-align:center;padding:18px;}
.status-bar{display:flex;align-items:center;justify-content:center;gap:15px;margin:22px 0;}
.status-badge{padding:8px 16px;border-radius:20px;font-size:12px;font-weight:600;}
.status-waiting{background:rgba(255,215,0,0.15);color:#ffd700;}
.status-ready{background:rgba(74,222,128,0.15);color:#4ade80;}
</style>
</head>
<body>
<div class="card">
<a href="dashboard.html" class="back-link">‚Üê Back to Dashboard</a>
<div class="page-header"><h1>Lobby</h1></div>

<div class="room-code-display">
<div class="room-code-label">Room Code</div>
<div class="room-code" id="roomCode">------</div>
<button class="copy-btn" onclick="copyRoomCode()">Copy Code</button>
</div>

<div class="section-title">Players in Lobby (<span id="playerCount">0</span>)</div>
<div class="players-section">
<div class="players-grid" id="playersList">
<p class="empty-msg" style="width:100%;">Waiting for players...</p>
</div>
</div>

<div class="status-bar">
<span class="status-badge status-waiting" id="statusBadge">Waiting for host to start...</span>
</div>

<script src="/socket.io/socket.io.js"></script>
<script>
// ==== Lobby setup ====
let PLAYER_NAME = prompt("Enter your name") || "Player";
let PLAYER_AVATAR = "üòÄ";
const socket = io();
let roomCode = "";

// Copy code
function copyRoomCode(){navigator.clipboard.writeText(roomCode);alert('Room code copied: '+roomCode);}

// Update players UI
function updatePlayersList(){ 
  const list = document.getElementById('playersList'); 
  const playerCount = document.getElementById('playerCount'); 
  playerCount.textContent = players.length; 
  if(players.length===0){list.innerHTML='<p class="empty-msg" style="width:100%;">Waiting for players...</p>';} 
  else{list.innerHTML=players.map(p=>`<div class="player-chip"><span class="avatar">${p.avatar}</span><span class="name">${p.name}</span></div>`).join('');}
}

// Store players
let players = [];

// ==== Socket events ====
socket.on('connect', ()=>{
  roomCode = sessionStorage.getItem('roomCode') || prompt("Enter room code");
  document.getElementById('roomCode').textContent = roomCode;
  socket.emit('joinPlayerRoom',{roomCode, name: PLAYER_NAME, avatar: PLAYER_AVATAR});
});

socket.on('lobbyUpdate', data=>{
  players = data.players;
  updatePlayersList();
  if(data.hostStarted){
    sessionStorage.setItem('roomCode', roomCode);
    window.location.href='player-game.html';
  }else{
    const badge = document.getElementById('statusBadge');
    badge.textContent = `üë• ${players.length} player(s) joined`;
    badge.className = 'status-badge status-waiting';
  }
});

socket.on('hostStartedGame', ()=>{
  window.location.href='player-game.html';
});
</script>
</div>
</body>
</html>
